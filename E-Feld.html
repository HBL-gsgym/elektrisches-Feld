<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Arbeitsblatt – Elektrisches Feld & Feldstärke (interaktiv)</title>

<!-- MathJax -->
<script>
window.MathJax = {
  tex: { inlineMath: [['\\(','\\)']], displayMath: [['\\[','\\]']] },
  options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code','select','option'] }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>
  html, body { height: 100%; }
  body{
    font-family: Arial, Helvetica, sans-serif;
    font-size: 12pt;
    line-height: 1.35;
    margin: 2.2cm;
    background: #f7f7f7;
    position: relative;
  }

  /* sanfter Hintergrund */
  body::before{
    content:"";
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    background:
      radial-gradient(circle at 18% 18%, rgba(0,0,0,0.08), transparent 33%),
      radial-gradient(circle at 78% 28%, rgba(0,0,0,0.06), transparent 38%),
      radial-gradient(circle at 30% 78%, rgba(0,0,0,0.05), transparent 45%),
      radial-gradient(circle at 65% 70%, rgba(0,0,0,0.035), transparent 50%),
      repeating-radial-gradient(circle at 25% 35%,
        rgba(0,0,0,0.018) 0px, rgba(0,0,0,0.018) 1px,
        transparent 10px, transparent 24px),
      repeating-radial-gradient(circle at 78% 55%,
        rgba(0,0,0,0.014) 0px, rgba(0,0,0,0.014) 1px,
        transparent 12px, transparent 28px),
      linear-gradient(to bottom, rgba(0,0,0,0.03), transparent 35%);
    background-attachment: fixed;
  }

  .page{ position: relative; z-index: 2; }

  .header{ border-bottom:1px solid #000; padding-bottom:0.2cm; margin-bottom:0.9cm; }
  .header table{ width:100%; border-collapse:collapse; }
  .header td{ font-weight:bold; }
  .left{text-align:left;}
  .center{text-align:center;}

  h1{ font-size:14pt; margin:0 0 0.2cm; }
  .small{ font-size:11pt; margin:0 0 0.5cm; }
  .muted{ color:#333; }

  .topRow{
    display:flex;
    gap:12px;
    align-items:flex-end;
    flex-wrap:wrap;
    margin-bottom: 0.2cm;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  .field label{ font-size:11pt; font-weight:bold; }
  .field input{
    font-size:12pt;
    padding:6px 8px;
    border:1px solid rgba(0,0,0,0.35);
    background:#fff;
    min-width: 280px;
    max-width: 520px;
  }
  .smallrow{ font-size:11pt; color:#333; margin-top:-2px; }

  .btns{ display:flex; gap:10px; margin:0.25cm 0; flex-wrap:wrap; }
  button{
    font-size:12pt;
    padding:6px 12px;
    border:1px solid #000;
    background:#fff;
    cursor:pointer;
  }
  button:disabled{ opacity:0.6; cursor:not-allowed; }

  .metaBox{
    font-size:11pt;
    padding:6px 10px;
    border:1px solid rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.75);
    max-width: 760px;
  }
  .metaBox b{ font-weight:bold; }

  .task{
    margin:0 0 0.95cm;
    border: 1px solid rgba(0,0,0,0.16);
    padding: 10px 12px;
    background: rgba(255,255,255,0.88);
  }

  .task:nth-of-type(10n+1){ background: rgba(235, 246, 255, 0.88); }
  .task:nth-of-type(10n+2){ background: rgba(237, 255, 245, 0.88); }
  .task:nth-of-type(10n+3){ background: rgba(255, 244, 235, 0.88); }
  .task:nth-of-type(10n+4){ background: rgba(246, 240, 255, 0.88); }
  .task:nth-of-type(10n+5){ background: rgba(255, 252, 232, 0.88); }
  .task:nth-of-type(10n+6){ background: rgba(240, 249, 255, 0.88); }
  .task:nth-of-type(10n+7){ background: rgba(252, 240, 248, 0.88); }
  .task:nth-of-type(10n+8){ background: rgba(241, 255, 236, 0.88); }
  .task:nth-of-type(10n+9){ background: rgba(245, 245, 245, 0.92); }
  .task:nth-of-type(10n+10){ background: rgba(255, 240, 240, 0.88); }

  .nr{ font-weight:bold; display:inline-block; width:2em; }
  .prompt{ margin:0.2cm 0 0.25cm; font-style:italic; }

  .mc label{ display:block; margin:6px 0; }
  .mc input{ margin-right:8px; }

  .feedback{ margin-top:0.2cm; font-weight:bold; }
  .ok{ color:#0a7a2f; }
  .bad{ color:#b00020; }
  .hint{ font-size:11pt; font-weight:normal; color:#333; }

  .solutionBtn{ display:none; margin-top:0.15cm; }
  .solution{ display:none; border-top:1px solid #000; margin-top:0.25cm; padding-top:0.25cm; }
  .solution h3{ font-size:12pt; margin:0 0 0.15cm; }
  .solution .small2{ font-size:11pt; }
  .solution .calc{ margin:0.2cm 0; padding:0.15cm 0.2cm; border:1px solid #000; background:#fff; }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1.25fr;
    gap: 10px 14px;
    margin-top: 8px;
    align-items:center;
  }
  .term{ font-weight:bold; }
  select{
    font-size:12pt;
    padding:4px 6px;
    border:1px solid rgba(0,0,0,0.4);
    background:#fff;
    width:100%;
    max-width: 820px;
  }

  .cloze{
    margin-top: 8px;
    padding: 8px 10px;
    border: 1px solid rgba(0,0,0,0.18);
    background: rgba(255,255,255,0.94);
  }
  .cloze-line{ margin: 8px 0; }
  .blank{ display:inline-block; min-width: 180px; vertical-align: middle; }

  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

  @media print{
    body::before{display:none;}
    button{display:none;}
    .solutionBtn{display:none !important;}
    .field{display:none;}
    .metaBox{display:none;}
  }
</style>
</head>

<body>
<div class="page">
  <div class="header">
    <table>
      <tr>
        <td class="left">HBL</td>
        <td class="center">Physik GK 11</td>
        <td></td>
      </tr>
    </table>
  </div>

  <h1>Elektrisches Feld und Feldstärke – Fragen (interaktiv)</h1>

  <div class="topRow">
    <div class="field">
      <label for="studentName">Name (Pflicht)</label>
      <input id="studentName" type="text" placeholder="Vorname Nachname" autocomplete="name">
      <div class="smallrow">Am Ende: „Ergebnisse an HBL senden“ (benötigt Internet).</div>
    </div>

    <div class="btns" style="margin:0;">
      <button onclick="showScore()">Ergebnis anzeigen</button>
      <button id="sendBtn" onclick="sendResults()" disabled>Ergebnisse an HBL senden</button>
      <button onclick="showInfo()">Info</button>
    </div>
  </div>

  <div class="metaBox">
    <b>Kurs:</b> <span id="metaCourse"></span> &nbsp;|&nbsp;
    <b>Arbeitsblatt:</b> <span id="metaSheet"></span>
  </div>

  <p class="small" style="margin-top:0.45cm;">
    <b>Regel:</b> Gezählt wird nur, ob eine Aufgabe <b>beim ersten Prüfen</b> richtig gelöst wurde.
    Wenn du eine Aufgabe <b>3× hintereinander falsch</b> prüfst, erscheint <b>„Lösungsweg anzeigen“</b>.
    <span class="muted">(Antwortreihenfolge ist pro Gerät gemischt. Fortschritt wird lokal gespeichert.)</span>
  </p>

  <div id="score" class="feedback" style="margin-top:-0.15cm;"></div>
  <div id="info" class="hint" style="margin-top:0.2cm;"></div>

  <!-- ===================== 1 ===================== -->
  <section class="task" data-task="1">
    <div><span class="nr">1.</span>
      <b>Welche Aussage beschreibt ein elektrisches Feld am treffendsten?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q1">
      <label><input type="radio" name="q1" value="a"> Ein elektrisches Feld ist eine „Kraft“, die überall gleich groß ist.</label>
      <label><input type="radio" name="q1" value="b"> Ein elektrisches Feld ist der Raum um Ladungen, in dem auf andere Ladungen Kräfte wirken.</label>
      <label><input type="radio" name="q1" value="c"> Ein elektrisches Feld entsteht nur in Metallen.</label>
      <label><input type="radio" name="q1" value="d"> Ein elektrisches Feld wirkt nur auf neutrale Körper.</label>
      <label><input type="radio" name="q1" value="e"> Ein elektrisches Feld ist identisch mit Magnetfeldlinien.</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(1,'q1','b')">Prüfen</button>
      <button onclick="resetUI(1)">Zurücksetzen</button>
    </div>
    <div id="f1" class="feedback"></div>
    <button id="sb1" class="solutionBtn" onclick="toggleSolution(1)">Lösungsweg anzeigen</button>
    <div id="sol1" class="solution">
      <h3>Lösungsweg (Aufgabe 1)</h3>
      <div class="small2">
        Ein elektrisches Feld beschreibt, dass im Raum um Ladungen Kräfte auf andere Ladungen wirken (Feld als „Vermittler“).
      </div>
    </div>
  </section>

  <!-- ===================== 2 ===================== -->
  <section class="task" data-task="2">
    <div><span class="nr">2.</span>
      <b>Was geben Feldlinien an?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q2">
      <label><input type="radio" name="q2" value="a"> Die Bahn, auf der sich Elektronen bewegen.</label>
      <label><input type="radio" name="q2" value="b"> Die Richtung der Kraft auf eine negative Probeladung.</label>
      <label><input type="radio" name="q2" value="c"> Die Richtung der Kraft auf eine positive Probeladung.</label>
      <label><input type="radio" name="q2" value="d"> Die Stärke der Spannung im Leiter.</label>
      <label><input type="radio" name="q2" value="e"> Die Richtung des elektrischen Stroms.</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(2,'q2','c')">Prüfen</button>
      <button onclick="resetUI(2)">Zurücksetzen</button>
    </div>
    <div id="f2" class="feedback"></div>
    <button id="sb2" class="solutionBtn" onclick="toggleSolution(2)">Lösungsweg anzeigen</button>
    <div id="sol2" class="solution">
      <h3>Lösungsweg (Aufgabe 2)</h3>
      <div class="small2">
        Feldlinien geben die Richtung der Kraft auf eine <b>positive</b> Probeladung an.
      </div>
    </div>
  </section>

  <!-- ===================== 3 ===================== -->
  <section class="task" data-task="3">
    <div><span class="nr">3.</span>
      <b>Welche Aussagen über Feldlinien sind richtig?</b>
    </div>
    <div class="prompt">Mehrfachauswahl (2 Antworten richtig)</div>
    <div class="mc" data-shuffle="q3">
      <label><input type="checkbox" name="q3" value="a"> Feldlinien können sich schneiden.</label>
      <label><input type="checkbox" name="q3" value="b"> Feldlinien verlaufen vom Plus- zum Minuspol.</label>
      <label><input type="checkbox" name="q3" value="c"> In Bereichen größerer Feldstärke sind Feldlinien dichter gezeichnet.</label>
      <label><input type="checkbox" name="q3" value="d"> Feldlinien verlaufen immer kreisförmig.</label>
      <label><input type="checkbox" name="q3" value="e"> Feldlinien enden nie an Ladungen.</label>
    </div>
    <div class="btns">
      <button onclick="checkMulti(3,'q3',['b','c'])">Prüfen</button>
      <button onclick="resetUI(3)">Zurücksetzen</button>
    </div>
    <div id="f3" class="feedback"></div>
    <button id="sb3" class="solutionBtn" onclick="toggleSolution(3)">Lösungsweg anzeigen</button>
    <div id="sol3" class="solution">
      <h3>Lösungsweg (Aufgabe 3)</h3>
      <div class="small2">
        Feldlinien verlaufen (konventionell) von \(+\) nach \(-\). Größere Feldstärke wird durch größere Liniendichte dargestellt.
      </div>
    </div>
  </section>

  <!-- ===================== 4 ===================== -->
  <section class="task" data-task="4">
    <div><span class="nr">4.</span>
      <b>Woran erkennt man (idealisiert) ein homogenes Feld zwischen parallelen Platten?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q4">
      <label><input type="radio" name="q4" value="a"> Feldlinien sind gekrümmt.</label>
      <label><input type="radio" name="q4" value="b"> Feldlinien sind parallel und gleich dicht.</label>
      <label><input type="radio" name="q4" value="c"> Feldlinien schneiden sich.</label>
      <label><input type="radio" name="q4" value="d"> Feldlinien werden zur Mitte hin dichter.</label>
      <label><input type="radio" name="q4" value="e"> Feldstärke ist proportional zu \(r^2\).</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(4,'q4','b')">Prüfen</button>
      <button onclick="resetUI(4)">Zurücksetzen</button>
    </div>
    <div id="f4" class="feedback"></div>
    <button id="sb4" class="solutionBtn" onclick="toggleSolution(4)">Lösungsweg anzeigen</button>
    <div id="sol4" class="solution">
      <h3>Lösungsweg (Aufgabe 4)</h3>
      <div class="small2">
        Homogen bedeutet: Richtung überall gleich \(\Rightarrow\) Feldlinien parallel; Stärke überall gleich \(\Rightarrow\) Liniendichte gleich.
      </div>
    </div>
  </section>

  <!-- ===================== 5 ===================== -->
  <section class="task" data-task="5">
    <div><span class="nr">5.</span>
      <b>Warum ist das Feld an einer Spitze (z.&nbsp;B. Blitzableiter) besonders stark?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q5">
      <label><input type="radio" name="q5" value="a"> Weil dort mehr Luft ist.</label>
      <label><input type="radio" name="q5" value="b"> Weil sich Ladung dort stärker konzentriert (kleiner Krümmungsradius).</label>
      <label><input type="radio" name="q5" value="c"> Weil das Magnetfeld dort stärker ist.</label>
      <label><input type="radio" name="q5" value="d"> Weil Feldlinien dort langsamer sind.</label>
      <label><input type="radio" name="q5" value="e"> Weil die Spannung dort automatisch kleiner ist.</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(5,'q5','b')">Prüfen</button>
      <button onclick="resetUI(5)">Zurücksetzen</button>
    </div>
    <div id="f5" class="feedback"></div>
    <button id="sb5" class="solutionBtn" onclick="toggleSolution(5)">Lösungsweg anzeigen</button>
    <div id="sol5" class="solution">
      <h3>Lösungsweg (Aufgabe 5)</h3>
      <div class="small2">
        Bei gleichem Gesamtladungsbetrag führt ein kleiner Krümmungsradius zu stärkerer Ladungsdichte an der Oberfläche → höhere Feldstärke.
      </div>
    </div>
  </section>

  <!-- ===================== 6 ===================== -->
  <section class="task" data-task="6">
    <div><span class="nr">6.</span>
      <b>Ordne zur Gewitterwolke die typische Ladungsverteilung zu.</b>
    </div>
    <div class="prompt">Zuordnung (3 Zuordnungen richtig)</div>

    <div class="grid">
      <div class="term">Oberseite der Gewitterwolke</div>
      <div>
        <select name="m6_1">
          <option value="">– bitte auswählen –</option>
          <option value="A">eher negativ geladen</option>
          <option value="B">eher positiv geladen</option>
          <option value="C">wird durch Influenz eher positiv</option>
          <option value="D">bleibt immer neutral</option>
          <option value="E">wird eher negativ</option>
        </select>
      </div>

      <div class="term">Unterseite der Gewitterwolke</div>
      <div>
        <select name="m6_2">
          <option value="">– bitte auswählen –</option>
          <option value="A">eher negativ geladen</option>
          <option value="B">eher positiv geladen</option>
          <option value="C">wird durch Influenz eher positiv</option>
          <option value="D">bleibt immer neutral</option>
          <option value="E">wird eher negativ</option>
        </select>
      </div>

      <div class="term">Erdoberfläche unter der Wolke</div>
      <div>
        <select name="m6_3">
          <option value="">– bitte auswählen –</option>
          <option value="A">eher negativ geladen</option>
          <option value="B">eher positiv geladen</option>
          <option value="C">wird durch Influenz eher positiv</option>
          <option value="D">bleibt immer neutral</option>
          <option value="E">wird eher negativ</option>
        </select>
      </div>
    </div>

    <div class="btns">
      <button onclick="checkMatch(6, {m1:'B', m2:'A', m3:'C'}, ['m6_1','m6_2','m6_3'])">Prüfen</button>
      <button onclick="resetUI(6)">Zurücksetzen</button>
    </div>

    <div id="f6" class="feedback"></div>
    <button id="sb6" class="solutionBtn" onclick="toggleSolution(6)">Lösungsweg anzeigen</button>
    <div id="sol6" class="solution">
      <h3>Lösungsweg (Aufgabe 6)</h3>
      <div class="small2">
        Typisch: Wolkenoberseite \(+\), Wolkenunterseite \(-\). Am Boden darunter entstehen durch Influenz eher positive Bereiche (Ladungstrennung).
      </div>
    </div>
  </section>

  <!-- ===================== 7 ===================== -->
  <section class="task" data-task="7">
    <div><span class="nr">7.</span>
      <b>Vervollständige die Definition der Feldstärke.</b>
    </div>
    <div class="prompt">Lückentext (2 Lücken richtig)</div>

    <div class="cloze">
      <div class="cloze-line">
        Die elektrische Feldstärke ist definiert als Quotient aus Kraft und Ladung:
      </div>
      <div class="cloze-line">
        <span class="mono">\(E=\)</span>
        <span class="blank">
          <select name="c7_1">
            <option value="">– auswählen –</option>
            <option value="F_el">\(F_\mathrm{el}\)</option>
            <option value="U">\(U\)</option>
            <option value="I">\(I\)</option>
            <option value="Q">\(Q\)</option>
            <option value="R">\(R\)</option>
          </select>
        </span>
        <span class="mono">\(/\)</span>
        <span class="blank">
          <select name="c7_2">
            <option value="">– auswählen –</option>
            <option value="q">\(q\)</option>
            <option value="t">\(t\)</option>
            <option value="A">\(A\)</option>
            <option value="d">\(d\)</option>
            <option value="m">\(m\)</option>
          </select>
        </span>
        <span class="mono">.</span>
      </div>
    </div>

    <div class="btns">
      <button onclick="checkCloze(7, {k1:'F_el', k2:'q'}, ['c7_1','c7_2'])">Prüfen</button>
      <button onclick="resetUI(7)">Zurücksetzen</button>
    </div>

    <div id="f7" class="feedback"></div>
    <button id="sb7" class="solutionBtn" onclick="toggleSolution(7)">Lösungsweg anzeigen</button>
    <div id="sol7" class="solution">
      <h3>Lösungsweg (Aufgabe 7)</h3>
      <div class="small2">
        Definition: \(\,E=\frac{F_\mathrm{el}}{q}\,\).
      </div>
    </div>
  </section>

  <!-- ===================== 8 ===================== -->
  <section class="task" data-task="8">
    <div><span class="nr">8.</span>
      <b>Welche Einheit hat die Feldstärke \(E\) gemäß \(E=\frac{F}{q}\)?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q8">
      <label><input type="radio" name="q8" value="a">\(\mathrm{N}\)</label>
      <label><input type="radio" name="q8" value="b">\(\mathrm{C}\)</label>
      <label><input type="radio" name="q8" value="c">\(\mathrm{N/C}\)</label>
      <label><input type="radio" name="q8" value="d">\(\mathrm{V\cdot m}\)</label>
      <label><input type="radio" name="q8" value="e">\(\mathrm{A/s}\)</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(8,'q8','c')">Prüfen</button>
      <button onclick="resetUI(8)">Zurücksetzen</button>
    </div>
    <div id="f8" class="feedback"></div>
    <button id="sb8" class="solutionBtn" onclick="toggleSolution(8)">Lösungsweg anzeigen</button>
    <div id="sol8" class="solution">
      <h3>Lösungsweg (Aufgabe 8)</h3>
      <div class="small2">
        \(\,E=\frac{F}{q}\Rightarrow [E]=\mathrm{\frac{N}{C}}\).
      </div>
    </div>
  </section>

  <!-- ===================== 9 ===================== -->
  <section class="task" data-task="9">
    <div><span class="nr">9.</span>
      <b>Rechnen: Eine Probeladung \(q=18\,\mathrm{nC}\) erfährt eine Kraft \(F=1{,}44\,\mathrm{mN}\). Berechne \(E\).</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q9">
      <label><input type="radio" name="q9" value="a">\(E=8{,}0\cdot 10^{4}\,\mathrm{N/C}\)</label>
      <label><input type="radio" name="q9" value="b">\(E=8{,}0\cdot 10^{1}\,\mathrm{N/C}\)</label>
      <label><input type="radio" name="q9" value="c">\(E=8{,}0\cdot 10^{7}\,\mathrm{N/C}\)</label>
      <label><input type="radio" name="q9" value="d">\(E=1{,}25\cdot 10^{4}\,\mathrm{N/C}\)</label>
      <label><input type="radio" name="q9" value="e">\(E=8{,}0\cdot 10^{-4}\,\mathrm{N/C}\)</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(9,'q9','a')">Prüfen</button>
      <button onclick="resetUI(9)">Zurücksetzen</button>
    </div>
    <div id="f9" class="feedback"></div>
    <button id="sb9" class="solutionBtn" onclick="toggleSolution(9)">Lösungsweg anzeigen</button>
    <div id="sol9" class="solution">
      <h3>Lösungsweg (Aufgabe 9)</h3>
      <div class="small2">
        <div class="calc">
          \[
            E=\frac{F}{q},\quad
            F=1{,}44\,\mathrm{mN}=1{,}44\cdot10^{-3}\,\mathrm{N},\quad
            q=18\,\mathrm{nC}=18\cdot10^{-9}\,\mathrm{C}
          \]
        </div>
        <div class="calc">
          \[
            E=\frac{1{,}44\cdot10^{-3}}{18\cdot10^{-9}}
            =0{,}08\cdot10^{6}
            =8{,}0\cdot10^{4}\,\mathrm{N/C}
          \]
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== 10 ===================== -->
  <section class="task" data-task="10">
    <div><span class="nr">10.</span>
      <b>Wie ändert sich die Feldstärke \(E(r)\) einer Punktladung/geladenen Kugel mit dem Abstand \(r\)?</b>
    </div>
    <div class="prompt">Einfachauswahl (1 Antwort richtig)</div>
    <div class="mc" data-shuffle="q10">
      <label><input type="radio" name="q10" value="a">\(E\propto r\)</label>
      <label><input type="radio" name="q10" value="b">\(E\propto \frac{1}{r}\)</label>
      <label><input type="radio" name="q10" value="c">\(E\propto \frac{1}{r^2}\)</label>
      <label><input type="radio" name="q10" value="d">\(E\propto r^2\)</label>
      <label><input type="radio" name="q10" value="e">\(E\) ist unabhängig von \(r\)</label>
    </div>
    <div class="btns">
      <button onclick="checkSingle(10,'q10','c')">Prüfen</button>
      <button onclick="resetUI(10)">Zurücksetzen</button>
    </div>
    <div id="f10" class="feedback"></div>
    <button id="sb10" class="solutionBtn" onclick="toggleSolution(10)">Lösungsweg anzeigen</button>
    <div id="sol10" class="solution">
      <h3>Lösungsweg (Aufgabe 10)</h3>
      <div class="small2">
        Für Punktladung/Kugel gilt (außerhalb): \(\,E(r)\propto \frac{1}{r^2}\,\) (Abnahme mit dem Quadrat des Abstands).
      </div>
    </div>
  </section>

</div>

<script>
/* ==================== KONFIG (fest) ==================== */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwNSC_7Jbv7j-NZpVHpWH41R-E97eVqg6BYLHI5N-Cn9cb7iGWHmiXiJk3RciO2gbM8XQ/exec";
const SHEET_ID = "elektrisches Feld";
const COURSE_NAME = "GK Ph 11 2025";
const STORE_KEY = "hbl_ab_elektrisches_feld_v1";

/* ==================== STATE ==================== */
const attempted = {};
const firstCorrect = {};
const wrongStreak = {};
const solutionUnlocked = {};
const feedbackCache = {};
let seed = null;

let studentName = "";
let startedAtISO = null;
let lastSent = null;

/* ==================== SAVE/LOAD ==================== */
function saveState(){
  const data = {
    seed, studentName, startedAtISO, lastSent,
    attempted, firstCorrect, wrongStreak, solutionUnlocked, feedbackCache,
    inputs: snapshotInputs(),
    selects: snapshotSelects()
  };
  try{ localStorage.setItem(STORE_KEY, JSON.stringify(data)); }catch(e){}
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){ return null; }
}
let saveTimer = null;
function scheduleSave(){
  clearTimeout(saveTimer);
  saveTimer = setTimeout(saveState, 120);
}
function snapshotInputs(){
  const result = {};
  const names = new Set([...document.querySelectorAll('input[name]')].map(i=>i.name));
  for(const n of names){
    const checked = [...document.querySelectorAll('input[name="'+n+'"]:checked')].map(x=>x.value).sort();
    result[n] = checked;
  }
  return result;
}
function snapshotSelects(){
  const result = {};
  document.querySelectorAll('select[name]').forEach(s => result[s.name] = s.value);
  return result;
}
function applyInputs(saved){
  if(!saved) return;
  for(const [name, arr] of Object.entries(saved)){
    const set = new Set(arr || []);
    document.querySelectorAll('input[name="'+name+'"]').forEach(inp => {
      inp.checked = set.has(inp.value);
    });
  }
}
function applySelects(saved){
  if(!saved) return;
  for(const [name, val] of Object.entries(saved)){
    const sel = document.querySelector('select[name="'+name+'"]');
    if(sel) sel.value = val;
  }
}
function applyFeedback(){
  for(const [k,v] of Object.entries(feedbackCache)){
    const n = Number(k);
    const el = document.getElementById('f'+n);
    if(el && v && typeof v.text === "string"){
      el.textContent = v.text;
      el.className = 'feedback ' + (v.okClass || '');
    }
  }
  for(const [k,unlocked] of Object.entries(solutionUnlocked)){
    const n = Number(k);
    if(unlocked){
      const b = document.getElementById('sb'+n);
      if(b) b.style.display = 'inline-block';
    }
  }
}
function attachAutoSave(){
  document.querySelectorAll('input, select').forEach(el=>{
    el.addEventListener('change', scheduleSave);
    el.addEventListener('input', scheduleSave);
  });
}

/* ==================== SHUFFLE ==================== */
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function ensureSeed(){
  const st = loadState();
  if(st && typeof st.seed === "number"){
    seed = st.seed;
    return;
  }
  seed = Math.floor(Math.random()*1e9);
  saveState();
}
function shuffleArray(arr, rnd){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(rnd()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
function shuffleMCBlocks(){
  const blocks = document.querySelectorAll('.mc[data-shuffle]');
  blocks.forEach((block, idx)=>{
    const rnd = mulberry32((seed + 1013*(idx+1)) >>> 0);
    const labels = [...block.querySelectorAll('label')];
    shuffleArray(labels, rnd);
    labels.forEach(l => block.appendChild(l));
  });
}

/* ==================== UI (Name) ==================== */
function updateSendBtn(){
  const btn = document.getElementById('sendBtn');
  studentName = (document.getElementById('studentName').value || "").trim();
  btn.disabled = (studentName.length === 0);
  scheduleSave();
}

/* ==================== SCORE / DETAILS ==================== */
function computeDetail(){
  const total = 10;
  let correctFirst = 0;
  let attemptedCount = 0;
  const firstCorrectTasks = [];
  const firstWrongTasks = [];

  for(let i=1;i<=total;i++){
    if(attempted[i]){
      attemptedCount++;
      if(firstCorrect[i]){
        correctFirst++;
        firstCorrectTasks.push(i);
      }else{
        firstWrongTasks.push(i);
      }
    }
  }
  return {
    total, correctFirst, attemptedCount,
    scoreStr: correctFirst + "/" + total,
    firstCorrectTasks, firstWrongTasks
  };
}

/* ==================== SEND ==================== */
function showSentOk(detail, note){
  lastSent = { name: studentName, course: COURSE_NAME, sheetId: SHEET_ID, score: detail.scoreStr, ts: new Date().toISOString() };
  const s = document.getElementById('score');
  s.className = 'feedback ok';
  s.textContent =
    "Gesendet ✅  (" + studentName +
    " | " + COURSE_NAME +
    " | " + SHEET_ID +
    " | " + detail.scoreStr +
    " | Erstversuch richtig: [" + detail.firstCorrectTasks.join(",") + "]" +
    " | Erstversuch falsch: [" + detail.firstWrongTasks.join(",") + "]" +
    (note ? " | " + note : "") +
    ")";
  scheduleSave();
}
function showSentFail(msg){
  const s = document.getElementById('score');
  s.className = 'feedback bad';
  s.textContent = "Senden fehlgeschlagen ❌ (" + msg + ")";
  scheduleSave();
}

async function sendResults(){
  if(!WEBAPP_URL){
    showSentFail("WEBAPP_URL ist leer.");
    return;
  }

  const name = (document.getElementById('studentName').value || "").trim();
  if(!name){
    const s = document.getElementById('score');
    s.className = 'feedback bad';
    s.textContent = 'Bitte zuerst den Namen eintragen.';
    return;
  }

  const detail = computeDetail();

  const sentAtISO = new Date().toISOString();
  const startedAt = startedAtISO ? new Date(startedAtISO) : new Date();
  const sentAt = new Date(sentAtISO);
  const workTimeSec = Math.max(0, Math.round((sentAt.getTime() - startedAt.getTime()) / 1000));

  const payload = {
    name: name,
    classCode: COURSE_NAME,
    sheetId: SHEET_ID,

    score: detail.scoreStr,
    attemptedCount: detail.attemptedCount,
    firstCorrectTasks: detail.firstCorrectTasks.join(","),
    firstWrongTasks: detail.firstWrongTasks.join(","),

    startedAt: startedAtISO,
    sentAt: sentAtISO,
    workTimeSec: workTimeSec,

    ua: navigator.userAgent
  };

  const btn = document.getElementById('sendBtn');
  btn.disabled = true;

  /* Erst CORS versuchen, dann no-cors Fallback (WebApp-abhängig) */
  try{
    const res = await fetch(WEBAPP_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if(!res.ok){
      throw new Error("HTTP " + res.status);
    }
    showSentOk(detail);
  }catch(e1){
    try{
      await fetch(WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      showSentOk(detail, "Fallback: no-cors");
    }catch(e2){
      showSentFail(String(e2 || e1));
    }
  }finally{
    setTimeout(() => { updateSendBtn(); }, 700);
  }
}

/* ==================== CHECK-LOGIK ==================== */
function ensureInit(n){
  if(!(n in wrongStreak)) wrongStreak[n] = 0;
  if(!(n in solutionUnlocked)) solutionUnlocked[n] = false;
}
function cacheFeedback(n, ok, msg){
  feedbackCache[n] = { text: msg, okClass: ok ? 'ok' : 'bad' };
}
function setNeedAnswer(n){
  const el=document.getElementById('f'+n);
  el.className='feedback bad';
  el.textContent='Bitte wähle zuerst eine Antwort aus.';
  cacheFeedback(n, false, el.textContent);
  scheduleSave();
}
function setFeedback(n, ok, isFirst, msg){
  const el = document.getElementById('f'+n);
  el.className = 'feedback ' + (ok ? 'ok' : 'bad');
  let text = msg ?? (ok ? 'Richtig ✅' : 'Falsch ❌');
  if(!isFirst) text += '  (Wertung bereits festgelegt)';
  el.textContent = text;
  cacheFeedback(n, ok, text);
  scheduleSave();
}
function getChecked(name){
  return [...document.querySelectorAll('input[name="'+name+'"]:checked')].map(x=>x.value).sort();
}
function afterCheck(n, ok){
  ensureInit(n);
  if(ok){
    wrongStreak[n] = 0;
  }else{
    wrongStreak[n] += 1;
    if(wrongStreak[n] >= 3 && !solutionUnlocked[n]){
      solutionUnlocked[n] = true;
      const b = document.getElementById('sb'+n);
      if(b) b.style.display = 'inline-block';
    }
  }
  scheduleSave();
}
function checkMulti(n, name, correct){
  const chosen = getChecked(name);
  if(chosen.length === 0){ setNeedAnswer(n); return; }

  const correctSet = new Set(correct);
  let right = 0;
  for(const v of chosen){ if(correctSet.has(v)) right++; }
  const wrong = chosen.length - right;
  const missing = correct.length - right;
  const ok = (wrong === 0 && missing === 0);

  const isFirst = !(n in attempted);
  if(isFirst){ attempted[n] = true; firstCorrect[n] = ok; }

  let msg = '';
  const expected = correct.length;

  if(chosen.length === 1){
    msg = (right === 1) ? 'Diese Auswahl ist korrekt.' : 'Diese Auswahl ist nicht korrekt.';
    msg += ' (Mehrfachauswahl: insgesamt ' + expected + ' richtige Antworten.)';
  } else if(ok){
    msg = 'Richtig ✅';
  } else {
    msg = 'Teilweise richtig: ' + right + ' richtig, ' + wrong + ' falsch gewählt';
    if(missing > 0) msg += ', ' + missing + ' richtig(e) fehlt/fehlen';
    msg += '. (Ausgewählt: ' + chosen.length + ', erwartet: ' + expected + ' richtige.)';
  }

  setFeedback(n, ok, isFirst, msg);
  afterCheck(n, ok);
  if(solutionUnlocked[n] && window.MathJax) MathJax.typesetPromise();
  saveState();
}
function checkSingle(n, name, correct){
  const chosen = getChecked(name);
  if(chosen.length===0){ setNeedAnswer(n); return; }
  const ok = (chosen.length===1 && chosen[0]===correct);

  const isFirst = !(n in attempted);
  if(isFirst){ attempted[n]=true; firstCorrect[n]=ok; }

  setFeedback(n, ok, isFirst, ok ? 'Richtig ✅' : 'Falsch ❌');
  afterCheck(n, ok);
  if(solutionUnlocked[n] && window.MathJax) MathJax.typesetPromise();
  saveState();
}
function checkMatch(n, key, names){
  const values = names.map(x => document.querySelector('select[name="'+x+'"]').value);
  if(values.some(v => v === '')){
    const el=document.getElementById('f'+n);
    el.className='feedback bad';
    el.textContent='Bitte fülle alle Zuordnungen aus.';
    cacheFeedback(n, false, el.textContent);
    scheduleSave();
    return;
  }
  let correctCount = 0;
  if(values[0] === key.m1) correctCount++;
  if(values[1] === key.m2) correctCount++;
  if(values[2] === key.m3) correctCount++;
  const ok = (correctCount === 3);

  const isFirst = !(n in attempted);
  if(isFirst){ attempted[n]=true; firstCorrect[n]=ok; }

  const msg = ok ? 'Richtig ✅' : ('Teilweise richtig: ' + correctCount + ' / 3 Zuordnungen korrekt.');
  setFeedback(n, ok, isFirst, msg);
  afterCheck(n, ok);
  if(solutionUnlocked[n] && window.MathJax) MathJax.typesetPromise();
  saveState();
}
function checkCloze(n, key, names){
  const values = names.map(x => document.querySelector('select[name="'+x+'"]').value);
  if(values.some(v => v === '')){
    const el=document.getElementById('f'+n);
    el.className='feedback bad';
    el.textContent='Bitte fülle alle Lücken aus.';
    cacheFeedback(n, false, el.textContent);
    scheduleSave();
    return;
  }
  let correctCount = 0;
  if(values[0] === key.k1) correctCount++;
  if(values[1] === key.k2) correctCount++;

  const ok = (correctCount === 2);

  const isFirst = !(n in attempted);
  if(isFirst){ attempted[n]=true; firstCorrect[n]=ok; }

  const msg = ok ? 'Richtig ✅' : ('Teilweise richtig: ' + correctCount + ' / 2 Lücken korrekt.');
  setFeedback(n, ok, isFirst, msg);
  afterCheck(n, ok);
  if(solutionUnlocked[n] && window.MathJax) MathJax.typesetPromise();
  saveState();
}
function resetUI(n){
  const sec=document.querySelector('section[data-task="'+n+'"]');
  sec.querySelectorAll('input').forEach(i=>i.checked=false);
  sec.querySelectorAll('select').forEach(s=>s.value='');

  const f=document.getElementById('f'+n);
  if(f){ f.textContent=''; f.className='feedback'; }
  delete feedbackCache[n];
  scheduleSave();
}
function toggleSolution(n){
  const sol=document.getElementById('sol'+n);
  sol.style.display = (sol.style.display==='block') ? 'none' : 'block';
  if(window.MathJax) MathJax.typesetPromise();
}
function showScore(){
  const d = computeDetail();
  const s=document.getElementById('score');
  s.className='feedback';
  s.textContent =
    "Kurs: " + COURSE_NAME + " | Arbeitsblatt: " + SHEET_ID + " | " +
    "Beim ersten Versuch richtig: " + d.correctFirst + " / " + d.total +
    "   (bereits geprüft: " + d.attemptedCount + " / " + d.total + ")" +
    "   | Richtig: [" + d.firstCorrectTasks.join(",") + "]" +
    "   | Falsch: [" + d.firstWrongTasks.join(",") + "]";
  scheduleSave();
}
function showInfo(){
  const lines = [];
  lines.push("• Mitgesendet: Name, Kurs (fest), Arbeitsblatt-ID (fest), Score, Erstversuch-Listen, Startzeit, Sendezeit, Arbeitszeit, UserAgent.");
  lines.push("• Kurs: " + COURSE_NAME);
  lines.push("• Arbeitsblatt: " + SHEET_ID);
  if(startedAtISO) lines.push("• Startzeit: " + startedAtISO);
  if(lastSent && lastSent.ts) lines.push("• Letztes Senden: " + lastSent.ts);
  document.getElementById('info').textContent = lines.join("  ");
}

/* ==================== BOOT ==================== */
document.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('metaCourse').textContent = COURSE_NAME;
  document.getElementById('metaSheet').textContent = SHEET_ID;

  const st0 = loadState();
  if(st0 && typeof st0.startedAtISO === "string") {
    startedAtISO = st0.startedAtISO;
  } else {
    startedAtISO = new Date().toISOString();
  }

  ensureSeed();
  shuffleMCBlocks();

  const st = loadState();
  if(st){
    if(typeof st.studentName === "string"){
      studentName = st.studentName;
      const inp = document.getElementById('studentName');
      if(inp) inp.value = studentName;
    }

    if(st.lastSent) lastSent = st.lastSent;

    if(st.attempted) Object.assign(attempted, st.attempted);
    if(st.firstCorrect) Object.assign(firstCorrect, st.firstCorrect);
    if(st.wrongStreak) Object.assign(wrongStreak, st.wrongStreak);
    if(st.solutionUnlocked) Object.assign(solutionUnlocked, st.solutionUnlocked);
    if(st.feedbackCache) Object.assign(feedbackCache, st.feedbackCache);

    applyInputs(st.inputs);
    applySelects(st.selects);
    applyFeedback();
  }

  document.getElementById('studentName').addEventListener('input', updateSendBtn);
  document.getElementById('studentName').addEventListener('change', updateSendBtn);
  updateSendBtn();

  attachAutoSave();
  saveState();

  if(window.MathJax) MathJax.typesetPromise();
});
</script>

</body>
</html>
